/**
 * Fiverr Categories
 * Handles categories behaviour
 *
 * Dependencies:
 * - jQuery 1.91
 * - Modernizr
 *
 */
(function (e) {
    var t = {
        layoutDefault: "auto", layoutSelected: "auto", layoutTypes: [], usesLayout: e(".js-layout-toggle").length > 0 ? !0 : !1, usesCache: !0, usesHiddenCache: !1, jsonGigsObjects: {}, jsonGigsLoaded: 0, isHomepage: !1, isSearch: !1, isSearchEmpty: !1, isFiltered: !1, searchParams: "", filterParams: "", filterClean: "", filterTypes: [], hashMod: window.location.search ? "?" : "#", abRatedHide: !1, gCrawl: !1, siteLocale: document.pageScope.locale, pageLocale: document.pageScope.locale, localeOverride: !1, init: function () { var t = this; document.pageScope.abtest && document.pageScope.abtest == "show_stars_row" && (t.abRatedHide = !0), document.pageScope.main === "categories" && document.pageScope.sub === "all" && (t.isHomepage = !0, t.usesHiddenCache = !0), document.pageScope.main === "landing_pages" && document.pageScope.sub === "show" && (t.usesCache = !1), document.pageScope.crawler && (t.gCrawl = !0, t.usesCache = !1, t.usesHiddenCache = !1); var n = Fiverr._getUrlHashVars(t.hashMod); document.pageScope.default_view && t.usesLayout && !Fiverr.isRealMobile && document.pageScope.default_view == "lists" && (t.layoutDefault = "lists", n.layout ? n["layout"] == "lists" && t.doLayoutReset(t.layoutDefault) : t.doLayoutReset(t.layoutDefault)), n.locale && (t.pageLocale = n.locale, t.pageLocale != t.siteLocale && (t.localeOverride = !0)), e(".js-gig-filter").length > 0 && (t.isFiltered = !0, n.filter ? (t.filterParams = "&filter=" + n.filter, t.filterClean = n.filter) : (t.filterParams = "&filter=auto", t.filterClean = "auto")), document.pageScope.main == "gigs" && document.pageScope.sub == "search" && (t.isSearch = !0, t.searchParams = "?", e.each(n, function (e, n) { switch (e) { case "category": case "filter": case "locale": case "order": case "query": case "search_in": case "utf8": case "x": case "y": t.searchParams += e + "=" + n + "&" } }), t.searchParams = t.searchParams.slice(0, -1), n.filter ? t.filterClean = n.filter : t.filterClean = "auto"), e(".container-markup-temp").length > 0 && t.initSeoMove(), e(".mp-subcategory-list").length > 0 && t.initSubcategoryList(), t.initInitialLoad() }, initSeoMove: function () { e(".mp-content-custom-markup").prepend(e(".container-markup-temp").html()), e(".container-markup-temp").remove() }, initSubcategoryList: function () { var t = e(".mp-subcategory-list"), n = t.find("span"), r = n.length, i = 4; for (var s = 0; s < i; s++) t.append("<ul></ul>"); e.each(n, function (e, r) { var s = e % i; t.find("ul").eq(s).append(n[e]) }), n.wrap("<li />"), t.addClass("cols-" + i), t.find(".inner").fadeIn("fast") }, fixFooterWhite: function (n) { var n = n ? n : t.layoutDefault; if (document.pageScope.main == "tags" || document.pageScope.main == "collections" || document.pageScope.main == "categories" && document.pageScope.sub != "all" || document.pageScope.main == "sub_categories") e(".mp-content-custom-markup").length > 0 ? e(".mp-footer-search").addClass("mp-footer-search-white") : e(".mp-footer-search").length > 0 && n == "lists" ? e(".mp-footer-search").addClass("mp-footer-search-white") : e(".mp-footer-search").length > 0 && e(".mp-layout.layout-" + n).find(".wrapper-white").length > 0 ? e(".mp-layout.layout-" + n).find(".wrapper-white").css("display") == "block" ? e(".mp-footer-search").addClass("mp-footer-search-white") : e(".mp-footer-search").removeClass("mp-footer-search-white") : e(".mp-footer-search").length > 0 && e(".mp-footer-search").removeClass("mp-footer-search-white") }, updateFilterLinks: function () { e(".js-gig-filter").find("li").removeClass("sel").parent().find('li[class="filter-' + t.filterClean + '"]').addClass("sel") }, initInitialLoad: function () { var n = this, r = !0, i = Fiverr._getUrlHashVars(t.hashMod); n.doInitialLoad = function () { var e = Fiverr._getUrlHashVars(t.hashMod); e.layout ? _.indexOf(t.layoutTypes, e.layout) > -1 ? t.triggerLayoutToggle(e.layout) : (t.cleanPageHash("layout"), t.triggerLayoutToggle(t.layoutDefault)) : t.triggerLayoutToggle(t.layoutDefault) }; if (t.isFiltered || t.usesLayout) { t.bindFilterAndLayout(), t.usesLayout && (e(".js-layout-toggle a").each(function (n) { var r = e(this).attr("href").substring(1); t.layoutTypes.push(r) }), t.isSearch && t.layoutTypes.push("profiles"), i.layout && (_.indexOf(t.layoutTypes, i.layout) > -1 ? i["layout"] != t.layoutDefault && (r = !1) : t.cleanPageHash("layout")), Fiverr._debug("FiverrCategories.layoutTypes", t.layoutTypes)), t.isFiltered && (e(".js-gig-filter li a").each(function (n) { var r = Fiverr._getUrlHashVars("#", e(this).attr("href")), i = r.filter; t.filterTypes.push(i) }), i.filter && _.indexOf(t.filterTypes, i.filter) < 0 && t.cleanPageHash("filter"), Fiverr._debug("FiverrCategories.filterTypes", t.filterTypes)); if (Fiverr.hasHistory5) { var s = t.hashMod == "?" ? "statechange" : "anchorchange"; History.Adapter.bind(window, s, function (e) { n.doInitialLoad() }) } else window.onhashchange = function (e) { n.doInitialLoad() } } r ? (e(".mp-layout.layout-" + t.layoutDefault).length > 0 ? t.initJsonGigs(e(".mp-layout.layout-" + t.layoutDefault)) : t.initJsonGigs(), t.fixFooterWhite(t.layoutDefault), t.isFiltered && t.updateFilterLinks()) : (t.layoutSelected = t.layoutDefault, t.triggerLayoutToggle(i.layout)) }, bindFilterAndLayout: function () { var n = this; e(".js-gig-filter li a").bind(Fiverr.clickEventType, function (r) { r.preventDefault(); if (!e(this).parent().hasClass("sel")) { var i = Fiverr._getUrlHashVars("#", e(this).attr("href")), s = "", o = ""; s = t.filterClean, o = i.filter, n.updateHash(s, o, "filter") } }), e(".js-layout-toggle a").bind(Fiverr.clickEventType, function (r) { r.preventDefault(); if (!e(this).hasClass("sel")) { var i = e(this).attr("href").substring(1), s = t.layoutSelected; n.updateHash(s, i, "layout") } }), n.updateHash = function (n, r, i) { if (n != r) { var s = Fiverr._getUrlHashVars(t.hashMod), o = Fiverr._getUrlHashVars(t.hashMod), u = window.location.search + window.location.hash, a = "([" + t.hashMod + "|&]" + i + "=)[^\\&]+", f = new RegExp(a); e.isEmptyObject(s) ? (u = t.hashMod + i + "=" + r, s[i] = r) : (i == "filter" && e.each(o, function (e, n) { if (e.substring(0, 4) == "jls_") { delete s[e]; var r = new RegExp("([" + t.hashMod + "|&]" + e + "=)[^\\&]+"); u = u.replace(r, ""), Fiverr._debug("updateHash: deleting " + e) } }), s[i] ? u = u.replace(f, "$1" + r) : u = u + "&" + i + "=" + r, s[i] = r), Fiverr._debug("filter/layout url hash array", s), Fiverr._debug("filter/layout url hash string", u), Fiverr.hasHistory5 ? History.pushState(s, document.title, u) : t.hashMod == "#" ? window.location.hash = u : t.hashMod == "?" && (window.location.search = u) } } }, triggerLayoutToggle: function (n) { var r = Fiverr._getUrlHashVars(t.hashMod), i = !1, s = !1, o = function (n) { e.each(t.jsonGigsObjects, function (e, n) { t.jsonGigsObjects[e].jsonobj.doReset() }); if (s) { var i = "auto"; r.filter && (i = r.filter), t.filterClean = i } t.isFiltered && t.updateFilterLinks(), t.layoutSelected = n, t.initJsonGigs(e(".mp-layout.layout-" + n)) }; t.layoutSelected != n ? i = !0 : r.filter ? t.isFiltered && t.filterClean != r["filter"] && (s = !0) : t.isFiltered && t.filterClean != "auto" && (s = !0); if (i || s) { if (n != "profiles") { var u = e(".js-layout-toggle"), a = u.find("a"); a.removeClass("sel"), u.find('a[href="#' + n + '"]').addClass("sel"), u.removeClass("sel-auto sel-boxes sel-lists").addClass("sel-" + n), t.isSearch && (e("#header-user-search").hide(), e("#header-gig-search").show()) } else e("#header-gig-search").hide(), e("#header-user-search").show(), t.layoutSelected == "lists" ? e(".mp-layout.layout-auto").hide() : e(".mp-layout.layout-lists").hide(); if (i) if (n == "profiles" || t.layoutSelected == "profiles") { e(".mp-layout.layout-" + t.layoutSelected).hide(), n == "profiles" ? e(".body-search .mp-layout-wrapper").addClass("wrapper-profiles") : (e(".js-total-search-results").text(""), e(".body-search .mp-layout-wrapper").removeClass("wrapper-profiles")), o(n); var f = e(".mp-layout.layout-" + n); f.show(), t.fixFooterWhite(n) } else e(".mp-layout.layout-" + t.layoutSelected).fadeOut("fast", function () { o(n); var r = e(".mp-layout.layout-" + n); r.fadeIn("fast", function () { t.fixFooterWhite(n) }) }); else o(n), t.fixFooterWhite(n) } }, doLayoutReset: function (n) { t.layoutSelected = n, e(".mp-layout").css("display", "none"), e(".mp-layout.layout-" + n).css("display", "block"), e(".js-layout-toggle a").removeClass("sel"), e(".js-layout-toggle").find('a[href="#' + n + '"]').addClass("sel"), e(".js-layout-toggle").removeClass("sel-auto sel-boxes sel-lists").addClass("sel-" + n) }, initJsonGigs: function (n, r) { var i = n ? e(n.find(".gig-carousel").not(".carousel-nojson")) : e(".gig-carousel").not(".carousel-nojson"), s = n ? e(n.find(".gig-column")) : e(".gig-column"), o = n ? e(n.find(".gig-columns-combined")) : e(".gig-columns-combined"), u = n ? e(n.find(".gig-columns-slim")) : e(".gig-columns-slim"), a = n ? e(n.find(".user-carousel")) : e(".user-carousel"), r = r ? r : !1; r || (t.jsonGigsObjects = {}, t.jsonGigsLoaded = 0), i.length > 0 && e.each(i, function (n, i) { var i = e(i), s = i.data("json-path"), o = !1; e(i).closest(".layout-fallback").length > 0 && (o = !0); if (!o || r) { var u = "jls_" + i.data("box-id"); t.jsonGigsObjects[t.jsonGigsLoaded] = { jsonid: u }; var a = new t.gigView(i, { jsonId: u, path: s, pathVars: Fiverr._getUrlVars(s), boxInner: ".js-coll-slider", boxType: "carousel", doSpecial: i.data("do-special") || !1, doEndless: i.data("do-endless") || !1, gigsShown: i.data("gigs-shown"), hideOnEmpty: i.data("hide-empty") || !1, loadMore: i.data("load-more") || !1, triggerOnEmpty: i.data("trigger-on-empty") || !1 }); t.jsonGigsObjects[t.jsonGigsLoaded].jsonobj = a, t.jsonGigsLoaded++ } }), s.length > 0 && e.each(s, function (n, i) { var i = e(i), s = i.data("json-path"), o = !1; e(i).closest(".layout-fallback").length > 0 && (o = !0); if (!o || r) { var u = "jls_" + i.data("box-id"); t.jsonGigsObjects[t.jsonGigsLoaded] = { jsonid: u }; var a = new t.gigView(i, { jsonId: u, path: s, pathVars: Fiverr._getUrlVars(s), boxInner: ".js-gig-items", boxType: "column single", doSpecial: i.data("do-special") || !1, doEndless: i.data("do-endless") || !1, gigsShown: i.data("gigs-shown"), hideOnEmpty: i.data("hide-empty") || !1, loadMore: i.data("load-more") || !1, triggerOnEmpty: i.data("trigger-on-empty") || !1 }); t.jsonGigsObjects[t.jsonGigsLoaded].jsonobj = a, t.jsonGigsLoaded++ } }), o.length > 0 && e.each(o, function (n, i) { var i = e(i), s = i.data("json-path"), o = !1; e(i).closest(".layout-fallback").length > 0 && (o = !0); if (!o || r) { var u = "jls_" + i.data("box-id"); t.jsonGigsObjects[t.jsonGigsLoaded] = { jsonid: u }; var a = new t.gigView(i, { jsonId: u, path: s, pathVars: Fiverr._getUrlVars(s), boxInner: ".js-gig-items", boxType: "column combined", doSpecial: i.data("do-special") || !1, doEndless: i.data("do-endless") || !1, gigsShown: i.data("gigs-shown"), hideOnEmpty: i.data("hide-empty") || !1, loadMore: i.data("load-more") || !1, triggerOnEmpty: i.data("trigger-on-empty") || !1 }); t.jsonGigsObjects[t.jsonGigsLoaded].jsonobj = a, t.jsonGigsLoaded++ } }), u.length > 0 && e.each(u, function (n, i) { var i = e(i), s = i.data("json-path"), o = !1; e(i).closest(".layout-fallback").length > 0 && (o = !0); if (!o || r) { var u = "jls_" + i.data("box-id"); t.jsonGigsObjects[t.jsonGigsLoaded] = { jsonid: u }; var a = new t.gigView(i, { jsonId: u, path: s, pathVars: Fiverr._getUrlVars(s), boxInner: ".js-gig-items", boxType: "column slim", doSpecial: !1, doEndless: i.data("do-endless") || !1, gigsShown: i.data("gigs-shown"), hideOnEmpty: i.data("hide-empty") || !1, loadMore: i.data("load-more") || !1, triggerOnEmpty: i.data("trigger-on-empty") || !1 }); t.jsonGigsObjects[t.jsonGigsLoaded].jsonobj = a, t.jsonGigsLoaded++ } }), a.length > 0 && e.each(a, function (n, i) { var i = e(i), s = i.data("json-path"), o = !1; e(i).closest(".layout-fallback").length > 0 && (o = !0); if (!o || r) { var u = "jls_" + i.data("box-id"); t.jsonGigsObjects[t.jsonGigsLoaded] = { jsonid: u }; var a = new t.userCarousel(i, { jsonId: u, path: s, pathVars: Fiverr._getUrlVars(s), boxInner: ".js-user-items", boxHost: i.data("host") || "search", usersShown: i.data("users-shown"), hideOnEmpty: i.data("hide-empty") || !1, loadMore: i.data("load-more") || !1, triggerOnEmpty: i.data("trigger-on-empty") || !1 }); t.jsonGigsObjects[t.jsonGigsLoaded].jsonobj = a, t.jsonGigsLoaded++ } }) }, gigView: function (n, r) {
            var i = this, s = { jsonId: r.jsonId, jsonIdLong: "jsonwrapper_" + r.jsonId, useStorage: Modernizr.localstorage, box: e(n), boxInner: e(n).find(r.boxInner), boxColL: e(n).find(".col-l"), boxColR: e(n).find(".col-r"), boxColLInner: !1, boxColRInner: !1, boxParent: e(n).parent(), boxType: r.boxType, btnLoadMore: e(n).parent().find(".gig-load-more"), page: 1, path: r.path, pathFilter: "auto", pathVars: r.pathVars, boxHost: r.pathVars.host, boxHostType: r.pathVars.type || !1, boxIsEmpty: !1, doSpecial: r.doSpecial || !1, doLoadMore: r.loadMore, doEndless: r.doEndless || !1, endlessAuto: !0, endlessAttached: !1, endlessObj: null, endlessPage: 1, gigsToLoad: r.pathVars.limit, gigsShown: r.gigsShown, gigTotals: 0, gigFader: null, gigFaderPaused: !1, hideOnEmpty: r.hideOnEmpty, triggerOnEmpty: r.triggerOnEmpty || !1, isFallback: !1, firstLoad: !0, carouselSize: 5 }, o = function () { t.gCrawl && (s.doEndless = !1, s.endlessAuto = !1, s.doSpecial = !1), Fiverr.isRealMobile && (s.doSpecial = !1, s.endlessAuto = !1), t.gCrawl || (s.boxType == "column combined" ? (s.boxColLInner = e(s.boxColL).find(s.boxInner), s.boxColRInner = e(s.boxColR).find(s.boxInner), e(s.boxColLInner).empty(), e(s.boxColRInner).empty()) : e(s.boxInner).empty()), s.boxType == "carousel" && s.boxParent.hasClass("mp-gig-carousel-four") && (s.carouselSize = 4), e(s.boxParent).closest(".layout-fallback").length > 0 && (s.isFallback = !0); if (t.isSearch || t.isFiltered) { s.pathFilter = t.filterClean; var n = t.jsonGigsLoaded; s.jsonId = s.jsonId + "_" + s.pathFilter, t.isSearch ? s.jsonIdLong = "jsonwrapper_" + s.pathVars.query_string + "_" + s.jsonId : s.jsonIdLong = "jsonwrapper_" + s.jsonId, t.jsonGigsObjects[n].jsonid = s.jsonId; if (t.isSearch) var r = new RegExp("([?|&]search_filter=)[^\\&]+"); else var r = new RegExp("([?|&]filter=)[^\\&]+"); s.path = s.path.replace(r, "$1" + s.pathFilter), Fiverr._debug("updating path: " + s.path), Fiverr._debug("updating jsonId: " + s.jsonId), Fiverr._debug("updating jsonIdLong: " + s.jsonIdLong) } if (t.gCrawl) { var o = Fiverr._getUrlHashVars(t.hashMod); o[s.jsonId] ? s.page = o[s.jsonId] : s.page = 1; var u = !1; s.boxType == "column combined" ? e(s.boxColLInner).children().length > 0 && (u = !0) : e(s.boxInner).children().length > 0 && (u = !0), u ? i.afterFirstLoad() : i.getGigItems() } else i.checkForCache() }; i.doReset = function () { s.boxType == "column combined" ? (s.boxColLInner = e(s.boxColL).find(s.boxInner), s.boxColRInner = e(s.boxColR).find(s.boxInner), e(s.boxColLInner).empty(), e(s.boxColRInner).empty(), s.boxColL.addClass("loading"), s.boxColR.addClass("loading")) : (e(s.boxInner).empty(), s.box.addClass("loading")), s.btnLoadMore.length > 0 && (s.btnLoadMore.hide().children("a").removeClass("disabled in-progress"), s.btnLoadMore.find("a").unbind()), s.firstLoad = !0, t.isSearchEmpty = !1, s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").addClass("layout-loading"); if (s.triggerOnEmpty) { var n = s.box.closest(".mp-layout").find("." + s.triggerOnEmpty); n.hide() } s.boxType == "column single" ? e(s.boxInner).height("auto") : s.boxType == "column combined" && (e(s.boxColLInner).height("auto"), e(s.boxColRInner).height("auto")), i.removeEndless() }, i.checkForCache = function () { var n = Fiverr._getUrlHashVars(t.hashMod), r = !1, o = !0, u = !1; if (t.usesCache) { if (t.usesHiddenCache && Fiverr.hasHistory5) { var a = History.getState(); n = a.data } e.each(n, function (e, t) { e == s.jsonId && (r = !0) }) } s.page = 1; if (r && s.doLoadMore && Modernizr.localstorage && t.usesCache) { var f = t.getLS(s.jsonIdLong), l = (new Date).getTime(); t.usesHiddenCache && f && l > f.expires && (f = !1); if (f) { Fiverr._debug("check for cache: stored data found", f), o = !1; var c = parseInt(s.gigsToLoad), h = 1, p = parseInt(f.gigs.length); p > c && (h = p / c, h = Math.ceil(h), Fiverr._debug("We just updated the page based on cache: " + h)), s.page = h, h > 1 && (e.isEmptyObject(n) || n[s.jsonId] != s.page) && (Fiverr._debug("check for cache: WE ARE DOING A HASH REPLACE"), t.replacePageHash(s.jsonId, s.page)), Fiverr._debug("LOADING " + p + " GIGS FROM CACHE!"), i.getGigItemsAfter(f, !0) } else Fiverr._debug("check for cache: no stored data found"), t.usesLayout && (Fiverr.hasHistory5 ? t.isSearch ? History.replaceState({ layout: t.layoutSelected }, document.title, t.searchParams + "&layout=" + t.layoutSelected) : History.replaceState({ layout: t.layoutSelected }, document.title, "#layout=" + t.layoutSelected + t.filterParams) : t.hashMod == "#" ? window.location.hash = "#layout=" + t.layoutSelected + t.filterParams : t.hashMod == "?" && (t.isSearch ? window.location.search = t.searchParams + "&layout=" + t.layoutSelected : window.location.search = "?layout=" + t.layoutSelected + t.filterParams)), t.isHomepage && (u = !0) } else t.isHomepage && (u = !0); if (u && !e.isEmptyObject(document.gigs_prefetched)) { var d = document.gigs_prefetched; s.jsonId == "jls_hp99912_1" && !e.isEmptyObject(d.handpicked_gigs) ? (Fiverr._debug("Loading prefetched gigs: handpicked_gigs", d.handpicked_gigs), o = !1, i.getGigItemsAfter(d.handpicked_gigs, !1)) : s.jsonId == "jls_hp99912_2" && !e.isEmptyObject(d.recent) ? (Fiverr._debug("Loading prefetched gigs: recent", d.recent), o = !1, i.getGigItemsAfter(d.recent, !1)) : s.jsonId == "jls_hp99912_3" && !e.isEmptyObject(d.top_rated_sellers) && (Fiverr._debug("Loading prefetched gigs: top_rated_sellers", d.top_rated_sellers), o = !1, i.getGigItemsAfter(d.top_rated_sellers, !1)) } o && i.getGigItems() }, i.afterFirstLoad = function () { s.boxHost == "search" && e.getJSON("/gigs/search_count_as_json?query_string=" + s.pathVars.query_string + "&search_filter=" + s.pathFilter, function (t) { t.total_results ? (e(".js-total-search-results").data("gig-results", parseInt(t.total_results)), parseInt(t.total_results) == 1 ? e(".js-total-search-results").text(e.t("categories.one_result")) : e(".js-total-search-results").text(parseInt(t.total_results) + " " + e.t("categories.results"))) : (e(".js-total-search-results").data("gig-results", "0"), e(".js-total-search-results").text(e.t("categories.no_results"))) }); if (!s.boxIsEmpty && !s.doSpecial && s.doLoadMore) { s.btnLoadMore.show(); var n = t.getNextPageUrl(s.jsonId, s.page); s.btnLoadMore.find("a").attr("href", n), t.gCrawl ? s.btnLoadMore.find("a").bind(Fiverr.clickEventType, function (e) { e.preventDefault(), window.location.href = s.btnLoadMore.find("a").attr("href"), location.reload(!0) }) : s.btnLoadMore.find("a").bind(Fiverr.clickEventType, function (n) { n.preventDefault(); if (!e(this).hasClass("disabled")) { e(this).addClass("disabled in-progress"), s.page += 1, s.endlessPage += 1; if (Modernizr.localstorage) { var r = t.getLSKeys(); r.length > 1 && e.each(r, function (n, r) { if (r.indexOf("jsonwrapper_") > -1) { var i = !0; e.each(t.jsonGigsObjects, function (e, n) { if (t.isSearch) var o = "jsonwrapper_" + s.pathVars.query_string + "_" + t.jsonGigsObjects[e].jsonid; else var o = "jsonwrapper_" + t.jsonGigsObjects[e].jsonid; r == o && (i = !1) }), i && (t.deleteLS(r), Fiverr._debug("DELETING LS object:", r)) } }) } i.attachEndless(!1, 1e3); var o = t.getNextPageUrl(s.jsonId, s.page); s.btnLoadMore.find("a").attr("href", o), i.getGigItems() } }) } s.doEndless && s.endlessAuto && i.attachEndless(!0, 1e3), s.isFallback && !s.boxIsEmpty && s.doLoadMore && i.attachEndless(!1, 1e3); if (s.boxType == "carousel" && s.doSpecial) var r = new Fiverr.initSimpleSlider(s.box, function () { }, 1015, 5); s.boxType == "carousel" && s.carouselSize == 4 && !Fiverr.isMobile && !Fiverr.isRealMobile && i.initCarouselHover(), s.boxType == "column single" && s.doSpecial && (i.startColumnFade(), columnInViewPort = _.debounce(i.columnInViewportCheck, 300), e(window).resize(function () { columnInViewPort() }).scroll(function () { columnInViewPort() })), s.boxType == "column combined" ? (s.boxColL.removeClass("loading"), s.boxColR.removeClass("loading")) : s.box.removeClass("loading"), s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").removeClass("layout-loading"), s.boxIsEmpty || e(".js-layout-toggle").show(), s.boxHost == "search" && s.isFallback && !t.isSearchEmpty && s.boxParent.children("header").show(), s.firstLoad = !1 }, i.getGigItems = function () { e.ajax({ url: s.path + "&page=" + s.page, dataType: "json", success: function (e) { i.getGigItemsAfter(e, !1) }, error: function (e) { console.log("JSON error ... fail fail fail! Fiverrtron is on it!"); var t = []; i.getGigItemsAfter(t, !1) } }) }, i.getGigItemsAfter = function (n, r) { var o = !1; if (!n || n.length < 1) i.checkForEnd(), o = !0; else if (n.gigs.length > 0) { if (t.usesCache) if (s.firstLoad && s.doLoadMore || s.doLoadMore) { if (s.useStorage) { var u = t.getLS(s.jsonIdLong), a = (new Date).getTime() + 3e5; Fiverr._debug("LS container name:", s.jsonIdLong); if (s.firstLoad) { u && (t.usesHiddenCache && r && u.expires && (a = u.expires), t.deleteLS(s.jsonIdLong)), t.usesHiddenCache && (n.expires = a); var f = t.setLS(s.jsonIdLong, n); f || (s.useStorage = !1), Fiverr._debug("new LS object:", t.getLS(s.jsonIdLong)) } else { e.merge(u.gigs, n.gigs), u.next_page && (u.next_page = n.next_page), t.usesHiddenCache && (u.expires = a); var f = t.setLS(s.jsonIdLong, u); f || (s.useStorage = !1), Fiverr._debug("adding to LS object:", t.getLS(s.jsonIdLong)) } } Fiverr._debug("We have loaded gigs and are updating the url"), t.replacePageHash(s.jsonId, s.page) } s.doLoadMore && (n.next_page ? (s.btnLoadMore.show().find("a").removeClass("disabled in-progress"), s.endlessAttached && s.doEndless && t.isHomepage && s.endlessPage == 4 && i.removeEndless()) : (s.btnLoadMore.hide().children("a").removeClass("disabled in-progress"), s.doLoadMore = !1, o = !0, i.removeEndless())), s.boxType == "column slim" ? i.addGigsToColumnSlim(n) : s.boxType == "carousel" ? i.addGigsToCarousel(n) : i.addGigsToColumn(n), t.isSearch && s.isFallback && !s.doLoadMore && !n.next_page && t.showBuyerRequests(s) } else i.checkForEnd(), o = !0; if (t.isFiltered && t.filterClean == "auto" || !t.isFiltered || t.isSearch) if (o && s.triggerOnEmpty) { var l = s.box.closest(".mp-layout").find("." + s.triggerOnEmpty); l.fadeIn("fast", function () { t.initJsonGigs(l, !0), t.fixFooterWhite(t.layoutSelected) }) } }, i.checkForEnd = function () { var n = !0; s.boxType == "column combined" ? e(s.boxColLInner).find(".gig-item").length > 0 && (n = !1) : e(s.boxInner).find(".gig-item").length > 0 && (n = !1), i.removeEndless(); if (n) { s.boxIsEmpty = !0, s.boxHost == "search" ? s.isFallback ? t.isSearchEmpty && t.showBuyerRequests(s) : t.isSearchEmpty = !0 : s.boxType == "column combined" ? e(s.boxColLInner).append('<div class="gig-item empty"><h5>' + e.t("categories.no_gigs_found") + "</h5></div>") : e(s.boxInner).append('<div class="gig-item empty"><h5>' + e.t("categories.no_gigs_found") + "</h5></div>"); if (s.firstLoad) { s.firstLoad = !1, s.boxHost == "search" && s.isFallback && t.isSearchEmpty && (e(".js-total-search-results").text(e.t("categories.no_results")), e(".js-total-search-results").data("gig-results", "0")); var r = s.hideOnEmpty; r && s.triggerOnEmpty && t.isFiltered && t.filterClean != "auto" && !t.isSearch && (r = !1), r ? s.boxHost == "search" ? s.boxParent.hide() : s.boxParent.fadeOut("fast") : (s.boxType == "column combined" ? (s.boxColL.removeClass("loading"), s.boxColR.removeClass("loading")) : s.box.removeClass("loading"), s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").removeClass("layout-loading")) } } else s.doLoadMore && (s.btnLoadMore.hide().children("a").removeClass("disabled in-progress"), s.doLoadMore = !1) }, i.setColumnHeight = function () { if (s.boxIsEmpty) s.boxType == "column single" ? e(s.boxInner).height(91) : (e(s.boxColLInner).height(91), e(s.boxColRInner).height(91)), s.doLoadMore && (s.btnLoadMore.hide(), s.doLoadMore = !1); else if (s.doSpecial) { s.gigTotals = e(s.boxInner).find(".gig-item").length, s.gigTotals < s.gigsShown && (s.gigsShown = s.gigTotals); var t = s.gigsShown * 107 - 16; e(s.boxInner).height(t) } else if (s.boxType == "column single") { s.gigTotals = e(s.boxInner).find(".gig-item").length; var t = s.gigTotals * 107 - 16; e(s.boxInner).height(t) } else { s.gigTotals = e(s.boxColLInner).find(".gig-item").length; var t = s.gigTotals * 107 - 16; e(s.boxColLInner).height(t), e(s.boxColRInner).height(t) } }, i.startColumnFade = function () { s.gigTotals = e(s.boxInner).find(".gig-item").length, s.gigTotals > s.gigsShown && (s.box.on("mouseenter", function () { s.gigFaderPaused = !0 }).mouseleave(function () { s.gigFaderPaused = !1 }), s.gigFader = setInterval(function () { i.doColumnFade(e(s.boxInner)) }, 6e3)) }, i.doColumnFade = function (e) { if (!s.gigFaderPaused) { var t = e.closest(".gig-column"); t.css({ overflow: "hidden", height: t.height() + "px" }), e.animate({ "padding-top": "107px" }, 600, function () { e.css("padding-top", "0px"); var t = e.find(".gig-item").last(); t.css("opacity", "0").prependTo(e), e.closest(".gig-column").css({ overflow: "visible", height: "auto" }), e.find(".gig-item").eq(0).animate({ opacity: "1" }, 300, function () { e.find(".gig-item").css("opacity", "1") }) }), e.find(".gig-item").eq(s.gigsShown - 1).animate({ opacity: "0" }, 600) } }, i.columnInViewportCheck = function () { Fiverr._isElementInViewport(s.boxInner) ? s.gigFaderPaused = !1 : s.gigFaderPaused = !0 }, i.initCarouselHover = function () { e(s.boxInner).on("mouseenter", ".gig-item", function (t) { var n = e(this), r = n.parent().position(), i = e(s.boxInner).find(".gig-item").index(n), o = e(s.boxInner).find(".gig-item").slice(i), u = !1; e(s.boxInner).find(".slide-push").length > 0 && e(s.boxInner).find(".slide-push").removeClass("slide-push"), o.each(function (t) { var n = e(this).parent().position(); if (Math.round(n.left) == Math.round(r.left) && Math.round(n.top) == Math.round(r.top + 241)) return e(this).addClass("slide-push"), u = !0, !1 }); if (!u) { var a = e(s.boxInner).innerWidth(), f = n.parent().outerWidth(), l = Math.floor(a / f); i + l < e(s.boxInner).find(".gig-item").length && e(s.boxInner).find(".gig-item").eq(i + l).addClass("slide-push") } }), e(s.boxInner).on("mouseleave", ".gig-item", function (t) { e(s.boxInner).find(".slide-push").removeClass("slide-push") }) }, i.attachEndless = function (n, r) { !s.endlessAttached && s.doEndless && (s.endlessPage = 1, s.endlessAttached = !0, s.endlessObj = e(s.boxParent).mpscroll({ distBuffer: r })), s.doLoadMore && n && s.btnLoadMore.addClass("endless-auto"), e("#main-wrapper").find(".js-pause-endless").length < 1 ? (e("#main-wrapper").prepend('<a href="#" class="btn-pause-endless js-pause-endless">More</a>'), e("#main-wrapper .js-pause-endless").bind(Fiverr.clickEventType, function (n) { n.preventDefault(), e(this).hasClass("disabled") || (e(this).addClass("disabled"), i.removeEndless(), t.isHomepage ? e(document).scrollTo(e(".mp-gig-columns"), { duration: 800, offset: { top: -145 }, easing: "easeInOutQuart" }) : e(document).scrollTo("max", { duration: 800, easing: "easeInOutQuart" })) })) : e("#main-wrapper .js-pause-endless").removeClass("disabled") }, i.removeEndless = function () { s.endlessAttached && (s.endlessObj.mpscroll.destroy(), s.endlessAttached = !1, s.doLoadMore && s.btnLoadMore.removeClass("endless-auto"), e("#main-wrapper .js-pause-endless").length > 0 && e("#main-wrapper .js-pause-endless").addClass("disabled")) }, i.addGigsToCarousel = function (t) { if (s.carouselSize == 4) var n = '<% _.each(data.gigs,function(gig){ %><% if (!_.has(gig, "expires_in")) { %><div class="js-slide"><div class="gig-item"><aside class="coll-heart" id="coll-gig-<%= gig.gig_id %>"><% if (!document.pageScope.currentUser) { %><a href="/join" class="icn-heart js-open-popup-join" rel="nofollow"></a><% } else { %><a class="icn-heart" href="#"></a><a class="icn-heart-toggle" href="#"></a><% } %></aside><% if (gig.video_thumb) { %><a href="<%= gig.gig_url %>?autoplay=true" class="vid-play" rel="nofollow"><%= $.t("general.play") %></a><% } %><a href="<%= gig.gig_url %>" class="gig-link-main"><% if (gig.is_featured) { %><aside class="featured-badge"><%= $.t("general.featured") %>!</aside><% } %><% if (gig.seller_level == "top_rated_seller") { %><span class="toprated-badge"><%= $.t("general.top_rated_seller") %>!</span><% } %><span class="gig-pict-214"><% if (gig.video_thumb) { %><% var newVideo = gig.video_thumb.replace("162x121","200x123") %><%= newVideo %><% } else { %><% var newImg = gig.img_medium.replace("/v2_162","/v2_200") %><% console.log(newImg) %><%= newImg %><% } %></span><h5 class="ellipsis"><%= $.t("setforms.i_will") %> <%= Fiverr._lowercaseFirstLetter(gig.title) %> <span class="gig-price"><em class="order"><%= $.t("general.order") %></em><em><%= gig.price %></em></span></h5></a><div class="gig-sub"><div class="user-pict-32"><%= gig.seller_img %></div><div class="seller-name"><a href="<%= gig.seller_url %>" rel="nofollow"><%= gig.seller_name %></a></div><div class="seller-stats cf"><% if (gig.rating_count > 0) { %><span class="ratings-count">(<% if (gig.rating_count > 1000) { %><%= Math.floor(gig.rating_count/1000) %>k+<% } else { %><%= gig.rating_count %><% } %>)</span><span class="rating-tiny rate-<%= gig.rating %>"></span><% } else { %><span class="ratings-count"><%= $.t("general.new_arrival") %></span><% } %><span class="seller-country"><%= gig.seller_country_name %></span></div></div></div></div><% } %><% }); %>'; else var n = '<% _.each(data.gigs,function(gig){ %><% if (!_.has(gig, "expires_in")) { %><div class="js-slide<% if (FiverrCategories.abRatedHide) { %> slide-norating<% } %>"><div class="gig-item"><aside class="coll-heart<% if (gig.is_featured) { %> coll-heart-push<% } %>" id="coll-gig-<%= gig.gig_id %>"><% if (!document.pageScope.currentUser) { %><a href="/join" class="icn-heart js-open-popup-join" rel="nofollow"></a><% } else { %><a class="icn-heart" href="#"></a><a class="icn-heart-toggle" href="#"></a><% } %></aside><% if (gig.video_thumb) { %><a href="<%= gig.gig_url %>?autoplay=true" class="vid-play" rel="nofollow"><%= $.t("general.play") %></a><% } %><a href="<%= gig.gig_url %>"><% if (gig.is_featured) { %><aside class="featured-badge"><%= $.t("general.featured") %>!</aside><% } %><span class="gig-pict-162"><% if (gig.seller_level == "top_rated_seller") { %><span class="toprated-badge"><%= $.t("general.top_rated_seller") %>!</span><% } %><% if (gig.video_thumb) { %><%= gig.video_thumb %><% } else { %><%= gig.img_medium %><% } %></span><div class="gig-sub"><% if (gig.rating_count > 0) { %><span class="mp-rating rate-<%= gig.rating %>"></span><span class="ratings-count">(<% if (gig.rating_count > 1000) { %><%= Math.floor(gig.rating_count/1000) %>k+<% } else { %><%= gig.rating_count %><% } %>)</span><% } else { %><span class="new-arrival"><%= $.t("general.new_arrival") %></span><% } %><span class="duration"><%= gig.duration %> <% if (gig.duration > 1) { %><%= $.t("general.days") %><% } else { %><%= $.t("general.day") %><% } %></span></div><h5 class="ellipsis"><%= Fiverr._uppercaseFirstLetter(gig.title) %> <em><%= $.t("general.from").toLowerCase() %> <%= gig.price %></em></h5></a><small><%= $.t("general.by") %> <a href="<%= gig.seller_url %>" rel="nofollow"><%= gig.seller_name %></a><% if (gig.seller_level != "" && gig.seller_level != null ) { %><span class="level-badge <%= gig.seller_level %>"></span><% } %><span class="flag <%= gig.seller_country %>"></span></small></div></div><% } %><% }); %>'; var r = '<% _.each(data.gigs,function(gig){ %><div class="js-slide<% if (FiverrCategories.abRatedHide) { %> slide-norating<% } %>"><div class="gig-item cf"><% if (gig.video_thumb) { %><a href="<%= gig.gig_url %>?autoplay=true" class="vid-play">Play</a><% } %><a href="<%= gig.gig_url %>"><% if (gig.is_featured) { %><aside class="featured-badge"><%= $.t("general.featured") %>!</aside><% } %><span class="gig-pict gig-pict-162"><% if (gig.seller_level == "top_rated_seller") { %><span class="toprated-badge"><%= $.t("general.top_rated_seller") %>!</span><% } %><% if (gig.video_thumb) { %><%= gig.video_thumb %><% } else { %><%= gig.img_medium %><% } %></span><div class="gig-sub"><% if (gig.rating_count > 0) { %><span class="mp-rating rate-<%= gig.rating %>"></span><% } else { %><span class="not-rated-yet"><%= $.t("general.not_rated_yet") %></span><% } %><span class="ratings-count">(<%= gig.rating_count %>)</span><span class="duration"><%= gig.duration %> <% if (gig.duration > 1) { %><%= $.t("general.days") %><% } else { %><%= $.t("general.day") %><% } %></span></div><h5 class="ellipsis"><%= Fiverr._uppercaseFirstLetter(gig.title) %> <em><%= $.t("general.from").toLowerCase() %> <%= gig.price %></em></h5></a></div></div><% }); %>', o = s.boxInner; if (s.firstLoad && !s.doLoadMore) Fiverr.isRealMobile ? e(s.boxInner).append(_.template(r, { data: t })) : e(s.boxInner).append(_.template(n, { data: t })); else { var u = _.template(n, { data: t }), a = s.jsonId + "_" + (new Date).getTime(); Fiverr.isRealMobile && (u = _.template(r, { data: t })), e(s.boxInner).append('<div class="' + a + '">' + u + "</div>"), o = "." + a } Fiverr.checkForBrokenImg(o), Fiverr.loadCollectionsList(o, !0), s.firstLoad && i.afterFirstLoad() }, i.addGigsToColumn = function (t) {
                var n = '<% _.each(data,function(gig){ %><% if (!_.has(gig, "expires_in")) { %><div class="gig-item"><aside class="coll-heart" id="coll-gig-<%= gig.gig_id %>"><% if (!document.pageScope.currentUser) { %><a href="/join" class="icn-heart js-open-popup-join" rel="nofollow"></a><% } else { %><a class="icn-heart" href="#"></a><a class="icn-heart-toggle" href="#"></a><% } %></aside><a href="<%= gig.gig_url %>"><% if (gig.is_featured) { %><aside class="featured-badge"><%= $.t("general.featured") %>!</aside><% } %><span class="gig-pict-102"><% if (gig.video_thumb) { %><span class="vid-play"><%= $.t("general.play") %></span><%= gig.video_thumb %><% } else { %><% var newImg = gig.img_medium.replace("/v2_162","/v2_102") %><%= newImg %><% } %></span><div class="gig-main"><h5 class="ellipsis"><span class="rf"><%= gig.price %></span><%= Fiverr._uppercaseFirstLetter(gig.title_full) %></h5><small class="gig-seller">by <%= gig.seller_name %><% if (gig.seller_level != "" && gig.seller_level != null ) { %><span class="level-badge <%= gig.seller_level %>"></span><% } %><span class="flag <%= gig.seller_country %>"></span></small></div><div class="gig-sub"><% if (gig.rating_count > 0) { %><span class="rating rate-<%= gig.rating %>"></span><span class="ratings-count">(<% if (gig.rating_count > 1000) { %><%= Math.floor(gig.rating_count/1000) %>k+<% } else { %><%= gig.rating_count %><% } %>)</span><% } %><span class="duration"><%= gig.duration %> <% if (gig.duration > 1) { %><%= $.t("general.days") %><% } else { %><%= $.t("general.day") %><% } %></span></div></a></div><% } %><% }); %>', r = t.gigs, o = r.length, u = s.boxInner; if (s.firstLoad && !s.doLoadMore) if (s.boxType == "column single") e(s.boxInner).append(_.template(n, { data: r })); else if (o > 1) {
                    var a = r.splice(0
                    , parseInt(o / 2)); e(s.boxColLInner).append(_.template(n, { data: a })), e(s.boxColRInner).append(_.template(n, { data: r })), Fiverr.checkForBrokenImg(s.boxColRInner), Fiverr.initDotDot(s.boxColRInner), Fiverr.loadCollectionsList(s.boxColRInner, !0), u = s.boxColLInner
                } else e(s.boxColLInner).append(_.template(n, { data: r })), u = s.boxColLInner; else if (s.boxType == "column single") { var f = _.template(n, { data: r }), l = s.jsonId + "_" + (new Date).getTime(); e(s.boxInner).append('<div class="' + l + '">' + f + "</div>"), u = "." + l } else if (o > 1) { var a = r.splice(0, parseInt(o / 2)), c = _.template(n, { data: a }), h = s.jsonId + "_l_" + (new Date).getTime(), p = _.template(n, { data: r }), d = s.jsonId + "_r_" + (new Date).getTime(); e(s.boxColLInner).append('<div class="' + h + '">' + c + "</div>"), e(s.boxColRInner).append('<div class="' + d + '">' + p + "</div>"), Fiverr.checkForBrokenImg("." + d), Fiverr.initDotDot("." + d), Fiverr.loadCollectionsList("." + d, !0), u = "." + h } else { var c = _.template(n, { data: r }), h = s.jsonId + "_l_" + (new Date).getTime(); e(s.boxColLInner).append('<div class="' + h + '">' + c + "</div>"), u = "." + h } Fiverr.checkForBrokenImg(u), Fiverr.initDotDot(u), Fiverr.loadCollectionsList(u, !0), i.setColumnHeight(), s.firstLoad && i.afterFirstLoad()
            }, i.addGigsToColumnSlim = function (t) { if (s.boxParent.hasClass("slim-alternate")) var n = '<% _.each(data.gigs,function(gig){ %><% if (!_.has(gig, "expires_in")) { %><div class="gig-item"><div class="gig-price"><a href="<%= gig.gig_url %>" class="btn-standard" rel="nofollow"><%= $.t("general.order_now") %> <%= gig.price %></a></div><% if (!FiverrCategories.abRatedHide) { %><div class="gig-rating"><% if (gig.rating_count > 0) { %><span class="ratings-count"><span class="mp-rating rate-<%= gig.rating %>"></span><br><%= gig.rating_count %> <% if (gig.rating_count == 1) { %><%= $.t("general.vote") %><% } else { %><%= $.t("general.votes") %><% } %></span><% } else { %><span class="not-rated-yet"><%= $.t("general.new_arrival") %></span><% } %></div><% } %><% if (gig.is_featured) { %><aside class="featured-badge">%= $.t("general.featured") %>!</aside><% } %><span class="gig-pict-102"><a href="<%= gig.gig_url %>"><% if (gig.video_thumb) { %><span class="vid-play">%= $.t("general.play") %></span><%= gig.video_thumb %><% } else { %><% var newImg = gig.img_medium.replace("/v2_162","/v2_102") %><%= newImg %><% } %></a></span><div class="gig-main"><h5 class="ellipsis"><a href="<%= gig.gig_url %>"><%= Fiverr._uppercaseFirstLetter(gig.title_full) %></a></h5><span><%= $.t("general.by") %> <a href="<%= gig.seller_url %>"><%= gig.seller_name %></a></span><% if (gig.seller_level != "" && gig.seller_level != null ) { %><span class="level-badge <%= gig.seller_level %>"></span><% } %><span><%= $.t("general.from") %> <em><%= gig.seller_country_name %></em></span><span class="flag <%= gig.seller_country %>"></span><span><%= $.t("user.joined") %> <em><%= $.t("user.joined_time", {time : gig.seller_created_at}) %></em></span><span><%= $.t("general.delivers_in") %> <em><%= gig.duration %> <% if (gig.duration > 1) { %><%= $.t("general.days") %><% } else { %><%= $.t("general.day") %><% } %></em></span></div></div><% } %><% }); %>'; else var n = '<% _.each(data.gigs,function(gig){ %><% if (!_.has(gig, "expires_in")) { %><div class="gig-item"><div class="gig-sub"><% if (!FiverrCategories.abRatedHide) { %><% if (gig.rating_count > 0) { %><span class="rating rate-<%= gig.rating %>"></span><span class="ratings-count">(<% if (gig.rating_count > 1000) { %><%= Math.floor(gig.rating_count/1000) %>k+<% } else { %><%= gig.rating_count %><% } %>)</span><% } else { %><span class="not-rated-yet"><%= $.t("general.new_arrival") %></span><% } %><% } %><span class="duration"><%= gig.duration %> <% if (gig.duration > 1) { %><%= $.t("general.days") %><% } else { %><%= $.t("general.day") %><% } %></span><span class="price"><%= gig.price %></span></div><span class="gig-pict-162"><a href="<%= gig.gig_url %>"><% if (gig.video_thumb) { %><%= gig.video_thumb %><% } else { %><% var newImg = gig.img_medium.replace("/v2_162","/v2_102") %><%= newImg %><% } %></a></span><div class="gig-main"><h5 class="ellipsis"><a href="<%= gig.gig_url %>"><%= Fiverr._uppercaseFirstLetter(gig.title_full) %></a></h5><span><%= $.t("general.by") %>: <a href="<%= gig.seller_url %>"><%= gig.seller_name %></a></span><span class="flag <%= gig.seller_country %>"></span><span><%= $.t("general.from") %>: <em><%= gig.seller_country_name %></em></span><span><%= $.t("user.joined_fiverr") %> <em><%= $.t("user.joined_time", {time : gig.seller_created_at}) %></em></span><% if (gig.seller_level != "" && gig.seller_level != null ) { %><span class="level-badge <%= gig.seller_level %>"></span><% } %></div></div><% } %><% }); %>'; var r = s.boxInner; if (s.firstLoad && !s.doLoadMore) e(s.boxInner).append(_.template(n, { data: t })); else { var o = _.template(n, { data: t }), u = s.jsonId + "_" + (new Date).getTime(); e(s.boxInner).append('<div class="' + u + '">' + o + "</div>"), r = "." + u } Fiverr.checkForBrokenImg(r), Fiverr.initDotDot(r), s.firstLoad && i.afterFirstLoad() }, o()
        }, userCarousel: function (n, r) { var i = this, s = { jsonId: r.jsonId, jsonIdLong: "jsonwrapper_" + r.jsonId, useStorage: Modernizr.localstorage, box: e(n), boxInner: e(n).find(r.boxInner), boxParent: e(n).closest(".mp-user-carousel"), boxMain: e(n).closest(".mp-user-carousel").find(".user-carousel-main"), boxSub: e(n).closest(".mp-user-carousel").find(".user-carousel-sub"), btnLoadMore: e(n).closest(".mp-user-carousel").find(".gig-load-more"), page: 1, path: r.path, pathVars: r.pathVars, boxHost: r.boxHost, boxIsEmpty: !1, usersToLoad: r.pathVars.limit, usersShown: r.usersShown, usersLoaded: 0, doLoadMore: r.loadMore, hideOnEmpty: r.hideOnEmpty, firstLoad: !0 }, o = function () { e(s.boxInner).empty(), s.jsonIdLong = "jsonwrapper_" + s.pathVars.username + "_" + s.jsonId, i.checkForCache() }; i.doReset = function () { e(s.boxInner).empty(), s.box.addClass("loading"), e(s.boxSub).find(".sub-links").empty(), e(s.boxSub).hide(), s.btnLoadMore.length > 0 && (s.btnLoadMore.hide().children("a").removeClass("disabled in-progress"), s.btnLoadMore.find("a").unbind()), s.firstLoad = !0, s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").addClass("layout-loading") }, i.checkForCache = function () { var n = Fiverr._getUrlHashVars(t.hashMod), r = !1, o = !0; e.each(n, function (e, t) { e == s.jsonId && (r = !0) }), s.page = 1; if (r && s.doLoadMore && Modernizr.localstorage) { var u = t.getLS(s.jsonIdLong); if (u) { Fiverr._debug("check for cache: stored users found", u), o = !1; var a = parseInt(s.usersToLoad), f = 1, l = parseInt(u.users.length); l > a && (f = l / a, f = Math.ceil(f)), s.page = f, f > 1 && (e.isEmptyObject(n) || n[s.jsonId] != s.page) && (Fiverr._debug("check for cache: WE ARE DOING A HASH REPLACE"), t.replacePageHash(s.jsonId, s.page)), Fiverr._debug("LOADING " + l + " USERS FROM CACHE!"), i.getCarouselUsersAfter(u) } else Fiverr.hasHistory5 ? History.replaceState({ layout: t.layoutSelected }, document.title, t.searchParams + "&layout=" + t.layoutSelected) : window.location.search = t.searchParams + "&layout=" + t.layoutSelected } Fiverr._debug("check for cache: current users page:", s.page), o && i.getCarouselUsers() }, i.afterFirstLoad = function (n) { s.boxHost == "search" && (n.total_results ? (e(".js-total-search-results").data("user-results", parseInt(n.total_results)), e(".js-total-search-results").text(parseInt(n.total_results) + " " + e.t("categories.results"))) : (e(".js-total-search-results").data("user-results", "0"), e(".js-total-search-results").text(e.t("categories.no_results")))), !s.boxIsEmpty && s.doLoadMore && (s.btnLoadMore.show(), s.btnLoadMore.find("a").bind(Fiverr.clickEventType, function (n) { n.preventDefault(); if (!e(this).hasClass("disabled")) { e(this).addClass("disabled in-progress"), s.page += 1; if (Modernizr.localstorage) { var r = t.getLSKeys(); r.length > 1 && e.each(r, function (n, r) { if (r.indexOf("jsonwrapper_") > -1) { var i = !0; e.each(t.jsonGigsObjects, function (e, n) { var o = "jsonwrapper_" + s.pathVars.username + "_" + t.jsonGigsObjects[e].jsonid; r == o && (i = !1) }), i && (t.deleteLS(r), Fiverr._debug("deleting users LS object:", r)) } }) } i.getCarouselUsers() } })), s.box.removeClass("loading"), s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").removeClass("layout-loading"), s.firstLoad = !1 }, i.getCarouselUsers = function () { e.ajax({ url: s.path + "&page=" + s.page, dataType: "json", success: function (e) { i.getCarouselUsersAfter(e) }, error: function (e) { console.log("JSON error ... fail fail fail! Fiverrtron is on it!"); var t = []; i.getCarouselUsersAfter(t) } }) }, i.getCarouselUsersAfter = function (n) { if (!n || n.length < 1) i.checkForEnd(); else if (n.users.length > 0) { n.total_results && (s.usersLoaded = parseInt(s.usersLoaded) + parseInt(n.users.length)); if (s.firstLoad && s.doLoadMore || s.doLoadMore) { if (s.useStorage) { var r = t.getLS(s.jsonIdLong); if (s.firstLoad) { r && t.deleteLS(s.jsonIdLong); var o = t.setLS(s.jsonIdLong, n); o || (s.useStorage = !1) } else { e.merge(r.users, n.users); var o = t.setLS(s.jsonIdLong, r); o || (s.useStorage = !1) } } Fiverr._debug("We have loaded users and are updating the url"), t.replacePageHash(s.jsonId, s.page) } s.doLoadMore && (s.btnLoadMore.find("a").removeClass("disabled in-progress"), n.total_results ? parseInt(s.usersLoaded) < parseInt(n.total_results) ? s.btnLoadMore.show() : (s.btnLoadMore.hide(), s.doLoadMore = !1) : (s.btnLoadMore.hide(), s.doLoadMore = !1)), i.addUsersToCarousel(n) } else i.checkForEnd() }, i.checkForEnd = function () { var t = !0; e(s.boxInner).find(".user-item").length > 0 && (t = !1), t ? (s.boxIsEmpty = !0, s.boxHost == "search" ? e(s.boxInner).append('<div class="user-item empty"><span class="user-pict-180"><img src="/assets/v2_globals/missing-image-180x180.png"></span><div class="user-main"><h4 class="ellipsis">' + e.t("search.no_user_found") + '</h4><h5 class="ellipsis">' + e.t("search.try_another_search") + "</h5></div></div>") : e(s.boxInner).append('<div class="user-item empty"><span class="user-pict-180"><img src="/assets/v2_globals/missing-image-180x180.png"></span><div class="user-main"><h4 class="ellipsis">' + e.t("search.no_user_available") + "</h4></div></div>"), s.firstLoad && (s.firstLoad = !1, s.boxHost == "search" && (e(".js-total-search-results").text(e.t("categories.no_results")), e(".js-total-search-results").data("gig-results", "0")), s.hideOnEmpty ? s.boxParent.fadeOut("fast") : (s.box.removeClass("loading"), s.box.closest(".layout-loader").length > 0 && s.box.closest(".layout-loader").removeClass("layout-loading")))) : s.doLoadMore && (s.btnLoadMore.hide().children("a").removeClass("disabled in-progress"), s.doLoadMore = !1) }, i.addUsersToCarousel = function (t) { var n = '<% _.each(data.users,function(user){ %><% if (user.has_img) { %><div class="user-item"><a href="<%= user.url %>"><span class="user-pict-180"><%= user.profile_img %></span><div class="user-main<% if (user.level != "" && user.level != null ) { %> with-badge<% } %>"><% if (user.level != "" && user.level != null ) { %><span class="user-badge-med <%= user.level %>"></span><% } %><h4 class="ellipsis"><%= user.username %></h4><h5 class="ellipsis"><%= user.country_name %><span class="flag <%= user.country %>"></span></h5><span class="mp-rating rate-<%= user.rating %>"></span></div></a></div><% } %><% }); %>', r = '<% _.each(data.users,function(user){ %><% if (!user.has_img) { %><a href="<%= user.url %>"><%= user.username %></a><% } %><% }); %>'; e(s.boxInner).append(_.template(n, { data: t })), e(s.boxSub).find(".sub-links").append(_.template(r, { data: t })), Fiverr.checkForBrokenImg(s.boxInner), Fiverr.initDotDot(s.boxInner), e(s.boxSub).find(".sub-links a").length > 0 && e(s.boxSub).show(), e(s.boxMain).find(".user-item").length > 0 ? e(s.boxMain).show() : e(s.boxMain).hide(), s.firstLoad && i.afterFirstLoad(t) }, o() }, showBuyerRequests: function (t) { t.boxIsEmpty && e(".mp-gig-filter").fadeOut("fast"), t.boxIsEmpty && t.boxParent.children("header").hide(), t.boxInner.find(".mp-empty-search-results").length < 1 && t.boxInner.append('<div class="span7 span-centered mp-empty-search-results"></div>'); var n = t.boxInner.find(".mp-empty-search-results"); t.boxIsEmpty ? n.removeClass("empty-pad") : n.addClass("empty-pad"), Fiverr.isRealMobile ? FiverrForms.initEmptySearchResults(n, t.boxIsEmpty) : (FiverrForms.initEmptySearchResults(n, t.boxIsEmpty), FiverrForms.showRecentGigRequestsList(n)) }, replacePageHash: function (n, r) { var i = Fiverr._getUrlHashVars(t.hashMod), s = {}, o = t.hashMod, u = !1, n = n, r = r; if (t.usesHiddenCache && Fiverr.hasHistory5) { var a = History.getState(); i = a.data } e.isEmptyObject(i) ? (t.usesLayout && (s.layout = t.layoutSelected, o += "layout=" + t.layoutSelected + "&"), s[n] = r, o += n + "=" + r + "&") : (e.each(i, function (i, a) { i == n ? (s[i] = r, o += i + "=" + r + "&", u = !0) : i.substring(0, 4) == "jls_" && t.levenshtein(n, i) > 1 ? e.each(t.jsonGigsObjects, function (e, n) { t.jsonGigsObjects[e]["jsonid"] == i && (s[i] = a, o += i + "=" + a + "&") }) : i.substring(0, 5) != "_suid" && (s[i] = a, o += i + "=" + a + "&") }), u || (s[n] = r, o += n + "=" + r + "&")), o = o.slice(0, -1), Fiverr.hasHistory5 ? t.usesHiddenCache ? History.replaceState(s, document.title, "") : History.replaceState(s, document.title, o) : t.hashMod == "#" ? window.location.hash = o : t.hashMod == "?" && (window.location.search = o) }, cleanPageHash: function (n) { Fiverr._debug("we are doing a cleanPageHash"); var r = Fiverr._getUrlHashVars(t.hashMod), i = {}, s = t.hashMod; e.isEmptyObject(r) || (e.each(r, function (e, r) { e == n ? n == "layout" ? (i[e] = t.layoutDefault, s += "layout=" + t.layoutDefault + "&", t.layoutSelected = t.layoutDefault) : (i[e] = "auto", s += n + "=auto&", n == "filter" && (t.isSearch ? t.searchParams = t.searchParams.replace(/([?|&]filter=)[^\&]+/, "$1auto") : t.filterParams = "&filter=auto", t.filterClean = "auto")) : e.substring(0, 5) != "_suid" && (i[e] = r, s += e + "=" + r + "&") }), s = s.slice(0, -1), Fiverr.hasHistory5 ? History.replaceState(i, document.title, s) : t.hashMod == "#" ? window.location.hash = s : t.hashMod == "?" && (window.location.search = s)) }, getNextPageUrl: function (e, n) { var r = window.location.href, i = "", s = new RegExp("(" + e + "=)[^\\&]+"), n = parseInt(n); return r.indexOf(e) > -1 ? i = r.replace(s, "$1" + (1 + n)) : i = t.hashMod + e + "=" + (1 + n), i }, setLS: function (e, t) { var n = window.localStorage, r = JSON.stringify(t); try { return n.setItem(e, r), !0 } catch (i) { if (i.name === "QuotaExceededError") return !1 } }, getLS: function (e) { var t, n = window.localStorage, r = n.getItem(e); try { t = JSON.parse(r), t == "true" && (t = !0), t == "false" && (t = !1), parseFloat(t) == t && (t = parseFloat(t)) } catch (i) { } return t }, deleteLS: function (e) { var t = window.localStorage; t.removeItem(e) }, getLSKeys: function () { var e = window.localStorage, t = new Array; for (var n in e) n.length && t.push(n); return t }, levenshtein: function (e, t) { if (e == t) return 0; var n = e.length, r = t.length; if (n === 0) return r; if (r === 0) return n; var i = !1; try { i = !"0"[0] } catch (s) { i = !0 } i && (e = e.split(""), t = t.split("")); var o = new Array(n + 1), u = new Array(n + 1), a = 0, f = 0, l = 0; for (a = 0; a < n + 1; a++) o[a] = a; var c = "", h = ""; for (f = 1; f <= r; f++) { u[0] = f, h = t[f - 1]; for (a = 0; a < n; a++) { c = e[a], l = c == h ? 0 : 1; var p = o[a + 1] + 1, d = u[a] + 1, v = o[a] + l; d < p && (p = d), v < p && (p = v), u[a + 1] = p } var m = o; o = u, u = m } return o[n] }
    }; window.FiverrCategories = t, e(document).ready(function () { t.init() })
})(jQuery);